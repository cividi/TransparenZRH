tasks:
  - type: package
    steps:
      - code: resource-transform
        name: data
        steps:
          - code: table-normalize
    source: 
      name: car-{{params.sensor_id}}
      title: MIV-ZÃ¤hlstelle {{params.sensor_name}}
      description: 
      sources: []
      licenses:
        - title: Creative Commons CCZero Lizenz
          name: CC0
          path: http://www.opendefinition.org/licenses/cc-zero
      resources:
        - data:
            - key: last_hour
              value: 400
              date: "{{params.date}}"
            - key: sum_today
              value: 3620
              date: "{{params.date}}"
            - key: sum_yesterday
              value: 20789
              date: "{{params.date}}"
            - key: mean_seven_days
              value: 4020
              date: "{{params.date}}"
          name: data
          format: inline
          schema:
            fields:
              - name: key
                type: string
              - name: value
                type: integer
              - name: date
                type: string
      views:
        - name: gauge_view_1
          resources:
            - data
          specType: gauge
          spec:
            mark: number
            filter:
              field: key
              equals: last_hour
            encoding:
              label: Letzte Stunde
              value:
                field: value
                type: quantitative
              unit: Fahrzeuge
        - name: gauge_view_2
          resources:
            - data
          specType: gauge
          spec:
            mark: number
            filter:
              field: key
              equals: sum_today
            encoding:
              label: Seit Mitternacht
              value:
                field: value
                type: quantitative
              unit: Fahrzeuge
        - name: gauge_view_3
          resources:
            - data
          specType: gauge
          spec:
            mark: number
            filter:
              field: key
              equals: sum_yesterday
            encoding:
              label: Summe gestern
              value:
                field: value
                type: quantitative
              unit: Fahrzeuge
        - name: gauge_view_4
          resources:
            - data
          specType: gauge
          spec:
            mark: number
            filter:
              field: key
              equals: mean_seven_days
            encoding:
              label: Tagesdurchschnitt letzte 7 Tage
              value:
                field: value
                type: quantitative
              unit: Fahrzeuge
        - name: gauge_view_5
          resources:
            - data
          specType: gauge
          spec:
            mark: svg
            encoding:
              label: Fahrzeuge je Stunde
              src: https://transparenzrh.eu-central-1.linodeobjects.com/car/{{params.sensor_id}}.svg